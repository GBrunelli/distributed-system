# apiVersion: batch/v1
# kind: Job
# metadata:
#     name: neo4j-uploader
#     namespace: etl
# spec:
#     template:
#         spec:
#             initContainers:
#                 - name: wait-for-neo4j
#                   image: busybox:latest
#                   command:
#                       - /bin/sh
#                       - -c
#                       - |
#                           echo "Checking Neo4j service availability..."
#                           until nc -z -v -w30 neo4j-headless.neo4j.svc.cluster.local 7687
#                           do
#                             echo "Waiting for Neo4j service to be available..."
#                             sleep 5
#                           done
#                           echo "Neo4j service is available."
#             containers:
#                 - name: neo4j-uploader
#                   image: gbrunelli/neo4j_uploader:latest
#             restartPolicy: OnFailure

apiVersion: batch/v1
kind: Job
metadata:
    name: mongo-uploader
    namespace: etl
spec:
    template:
        spec:
            initContainers:
                - name: wait-for-mongo
                  image: busybox:latest
                  command:
                      - /bin/sh
                      - -c
                      - |
                          echo "Checking MongoDB service availability..."
                          until nc -z -v -w30 mongo.mongodb.svc.cluster.local 27017
                          do
                            echo "Waiting for MongoDB service to be available..."
                            sleep 5
                          done
                          echo "MongoDB service is available."
            containers:
                - name: mongo-uploader
                  image: seu_usuario/mongo_uploader:latest
                  env:
                      - name: MONGO_URI
                        value: "mongodb://mongo.mongodb.svc.cluster.local:27017/your_database"
                  args:
                      - python
                      - /app/upload_to_mongo.py
                  resources:
                      requests:
                          memory: "128Mi"
                          cpu: "100m"
                      limits:
                          memory: "256Mi"
                          cpu: "200m"
            restartPolicy: OnFailure
